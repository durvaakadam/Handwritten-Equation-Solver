<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Handwritten Equation Solver</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Roboto', sans-serif;
    background: #e0e5ec;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: #333;
}

.container {
    display: flex;
    width: 90%;
    max-width: 1100px;
    height: 75%;
    background: #fff;
    border-radius: 20px;
    box-shadow: 0 16px 50px rgba(0,0,0,0.15);
    overflow: hidden;
    transition: all 0.3s ease;
}

.left, .right {
    flex: 1;
    padding: 35px 30px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
}

.left {
    border-right: 1px solid #ddd;
    background: linear-gradient(160deg, #fdfbfb, #ebedee);
}

h1 {
    font-size: 2rem;
    margin-bottom: 25px;
    color: #2c3e50;
    text-align: center;
}

.canvas-wrapper {
    position: relative;
    width: 100%;
    max-width: 450px;
    height: 220px;
    border-radius: 18px;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    margin-bottom: 25px;
    background: linear-gradient(135deg, #fefefe, #e1e5ec);
    transition: all 0.3s ease;
}

.canvas-wrapper:hover {
    box-shadow: 0 12px 35px rgba(0,0,0,0.18);
    transform: translateY(-3px);
}

canvas {
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 18px;
    border: none;
    cursor: crosshair;
    background: transparent;
}

.buttons {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
}

button {
    padding: 12px 24px;
    font-size: 16px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.25s ease;
    color: #fff;
    background: linear-gradient(135deg, #6a11cb, #2575fc);
    box-shadow: 0 5px 15px rgba(0,0,0,0.15);
}

button:hover {transform: translateY(-2px);box-shadow: 0 8px 20px rgba(0,0,0,0.2);}
#predictBtn { background: #27ae60; /* solid green */}
#clearBtn { background: #e74c3c; /* solid red */}
#saveBtn { background: #2980b9; /* solid blue */ margin-top: 15px; }


.upload-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
}

.upload-section input[type="file"] {
    padding: 6px;
    font-size: 14px;
    margin-bottom: 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    cursor: pointer;
    width: 90%;
    max-width: 250px;
}

.results {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.results label {
    font-weight: 600;
    margin-bottom: 6px;
    color: #34495e;
}

.results input {
    width: 90%;
    padding: 12px 16px;
    border-radius: 12px;
    border: 1px solid #ccc;
    font-size: 16px;
    transition: all 0.25s ease;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
}

.results input:focus {
    border-color: #3498db;
    box-shadow: 0 0 12px rgba(52,152,219,0.2);
    outline: none;
}

@media(max-width: 900px) {
    .container {
        flex-direction: column;
        height: auto;
    }
    .left, .right {
        border-right: none;
        width: 100%;
    }
    .canvas-wrapper { height: 200px; }
    .results input { width: 100%; }
}
</style>

</head>
<body>

<div class="container">
    <div class="left">
        <h1>Draw Equation</h1>
        <div class="canvas-wrapper">
            <canvas id="drawCanvas" width="400" height="220"></canvas>
        </div>
        <div class="buttons">
            <button id="predictBtn">Predict</button>
            <button id="clearBtn">Clear</button>
        </div>
        <div class="upload-section">
            <input type="file" id="fileInput">
            <button id="saveBtn">Upload</button>
        </div>
    </div>
    
    <div class="right">
        <h1>Results</h1>
        <div class="results">
            <div>
                <label>Entered Equation</label>
                <input type="text" id="prediction" readonly placeholder="Prediction will appear here">
            </div>
            <div>
                <label>Formatted Equation</label>
                <input type="text" id="formatted" readonly placeholder="Equation formatted">
            </div>
            <div>
                <label>Result</label>
                <input type="text" id="result" readonly placeholder="Result will appear here">
            </div>
        </div>
    </div>
</div>

<script>
const canvas = document.getElementById("drawCanvas");
const ctx = canvas.getContext("2d");

// White background
ctx.fillStyle = "#fff";
ctx.fillRect(0, 0, canvas.width, canvas.height);

// Drawing settings
ctx.lineWidth = 3;
ctx.lineCap = "round";
ctx.strokeStyle = "#2c3e50";

let drawing = false;

// Fix cursor offset on CSS-scaled canvas
function getMousePos(canvas, evt) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    return {
        x: (evt.clientX - rect.left) * scaleX,
        y: (evt.clientY - rect.top) * scaleY
    };
}

// Drawing Events
canvas.addEventListener("mousedown", e => {
    drawing = true;
    const pos = getMousePos(canvas, e);
    ctx.beginPath();
    ctx.moveTo(pos.x, pos.y);
});

canvas.addEventListener("mousemove", e => {
    if (!drawing) return;
    const pos = getMousePos(canvas, e);
    ctx.lineTo(pos.x, pos.y);
    ctx.stroke();
});

canvas.addEventListener("mouseup", () => drawing = false);
canvas.addEventListener("mouseleave", () => drawing = false);

// Buttons
document.getElementById("clearBtn").addEventListener("click", () => {
    ctx.fillStyle = "#fff";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
});

document.getElementById("predictBtn").addEventListener("click", () => sendCanvas());
document.getElementById("saveBtn").addEventListener("click", () => {
    const fileInput = document.getElementById("fileInput");
    if(fileInput.files.length > 0){
        const reader = new FileReader();
        reader.onload = e => sendImage(e.target.result);
        reader.readAsDataURL(fileInput.files[0]);
    } else {
        alert("Please select a file first!");
    }
});

// Send canvas image to server
function sendCanvas() {
    const dataURL = canvas.toDataURL("image/png");
    sendImage(dataURL);
}

// Common send function
function sendImage(dataURL){
    fetch("/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ image: dataURL })
    })
    .then(res => res.json())
    .then(data => {
        if(data.error){
            alert("Error: " + data.error);
            return;
        }
        document.getElementById("prediction").value = data.prediction;
        document.getElementById("formatted").value = data.prediction; 
        document.getElementById("result").value = data.result;
    })
    .catch(err => alert("Request failed: " + err));
}
</script>

</body>
</html>
